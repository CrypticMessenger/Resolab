@startuml
skinparam componentStyle uml2
skinparam backgroundColor white
skinparam handheldBackgroundColor WhiteSmoke

package "Client (Browser)" {
  component "SpatialAudioEditor" as Editor
  component "Three.js Canvas" as Visuals
  component "Web Audio Graph" as AudioEngine
  database "IndexedDB\n(Audio Cache)" as IDB
}

package "Server (Next.js Actions)" {
  component "Auto-Foley Agent\n(analyzeVideoAction)" as AutoFoley
  component "AI Director Agent\n(generateSceneAction)" as Director
  component "Asset Matcher" as AssetLib
}

cloud "External Services" {
  component "Supabase Storage" as Storage
  component "Google AI\nFile Manager" as GFileManager
  component "Google Gemini 3\n(Flash Preview)" as Gemini
}

' User Interaction
User -> Editor : Upload Video / Prompt

' Auto-Foley Flow
Editor -> Storage : 1. Upload Video (Direct)
Editor -> AutoFoley : 2. Invoke Action (Video URL)
AutoFoley -> Storage : 3. Download Video to Temp
AutoFoley -> GFileManager : 4. Upload & Poll Status
AutoFoley -> Gemini : 5. Generate Content (File URI)
Gemini -> AutoFoley : 6. Scene JSON (Coords + Tags)
AutoFoley -> GFileManager : 7. Cleanup File
AutoFoley -> AssetLib : 8. Map Tags to Audio URLs
AssetLib -> AutoFoley : 9. Asset URLs

' Response Handling
AutoFoley -> Editor : 10. Return Hydrated Scene
Editor -> IDB : 11. Cache Audio Data
Editor -> Visuals : 12. Render 3D Objects
Editor -> AudioEngine : 13. Sync Spatial Nodes

@enduml
